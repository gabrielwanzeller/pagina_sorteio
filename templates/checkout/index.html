<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/checkout.css') }}">
</head>
<body>
  <main class="checkout-container">
    <section class="product-card">
      <img src="/static/img/produto.png" alt="Produto" class="product-image">
      <div class="product-info">
        <h2 style="color: rgb(67, 67, 67);">Sorteio Delas</h2>
        <p>iPhone 15 zerado + PIX de R$300 + PIX de R$100</p>
        <strong class="product-price" id="checkout-valor">Por R$ <span id="checkout-valor-dinamico"></span></strong>
      </div>
    </section>

    <div class="progress-indicator">
      <div class="step active">Dados Pessoais</div>
      <div class="step">Pagamento</div>
    </div>

    <section class="form-section">
      <h3>Dados Pessoais</h3>
      <p>Preencha os dados essenciais para o processo de compra</p>
      <div id="checkout-form" novalidate>
        <input type="text" id="nome" name="nome" placeholder="Nome completo" required>
        <input type="email" id="email" name="email" placeholder="E-mail" required>
        <input type="tel" name="celular" id="celular" placeholder="Celular" required pattern="[0-9]{10,11}" inputmode="numeric">
        <button type="button" id="continue-button" class="continue-btn">CONTINUAR</button>
        <div id="personal-error-message" style="margin-top: 15px; color: red; font-weight: bold;"></div>
      </div>

      <div id="payment-response" style="margin-top: 30px; display: none;">
        <h3>Pagamento</h3>
        <p>Selecione a forma de pagamento desejada</p>
        <div class="payment-tabs">
          <button type="button" id="btn-credit" class="tab tab-button active" data-tab="credit-form">üí≥ Cart√£o de Cr√©dito</button>
          <button type="button" id="btn-pix" class="tab tab-button" data-tab="pix-instructions">üè¶ Pix</button>
        </div>

        <div id="credit-form" class="payment-tab-content active">
          <p><img src="/static/img/mercadopago-logo.png" alt="Mercado Pago" style="height: 20px;"> Processado por</p>
          <form id="form-checkout" autocomplete="off">
            <input type="text" id="cardNumber" name="cardNumber" placeholder="Numero do Cart√£o" required pattern="[0-9]{13,19}" inputmode="numeric">
            <input type="text" id="cardExpiration" name="cardExpiration" placeholder="Validade" required>
            <input type="text" id="securityCode" name="cardCvv" placeholder="CVV" required>
            <input type="text" id="cardholderName" name="cardHolderName" placeholder="Nome do Titular do Cart√£o" required>
            <input type="email" id="emailCartao" name="emailCartao" placeholder="E-mail do Titular" required>
            <select id="identificationType" style="display:none;">
              <option value="CPF" selected>CPF</option>
            </select>
            <input type="text" name="cpf" id="cpf" placeholder="CPF (obrigat√≥rio para cart√£o de cr√©dito)" pattern="[0-9]{11}" inputmode="numeric" required>
            <select id="installments" name="installments">
              <!-- Ser√° preenchido dinamicamente via JS -->
            </select>
            <select id="issuer" style="display:none;"></select>
            <input type="hidden" id="cardToken" name="cardToken">
          </form>
          <button type="button" class="continue-btn" id="buy-now-credit">COMPRAR AGORA ‚úî</button>
          <div id="spinner" style="display:none; margin-top: 20px;">
            <img src="/static/img/spinner.svg" alt="Carregando..." style="width: 30px;">
          </div>
          <div id="status-message" style="margin-top: 20px; font-weight: bold;"></div>
          <button class="back-btn">¬´ REVISAR DADOS PESSOAIS</button>
        </div>

        <div id="pix-instructions" class="payment-tab-content" style="display: none;">
          <div class="pix-box">
            <h4>üü¢ Pagamento via Pix</h4>
            <p>Voc√™ ser√° redirecionado para finalizar o pagamento com Pix.</p>
            <button type="button" id="buy-now-pix" class="continue-btn">IR PARA O PIX</button>
          </div>
        </div>
      </div>
    </section>

    <div class="secure-text">
      <span>üõ°Ô∏è Pagamento 100% Seguro</span>
    </div>

    <footer class="payment-brands">
      <p>Formas de pagamento</p>
      <div class="brands">
        <img src="/static/img/bandeiras-cartoes.png" alt="Bandeiras de cart√£o">
      </div>
    </footer>
  </main>
  <script src="{{ url_for('static', filename='js/checkout.js') }}"></script>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</body>
</html>